{"version":3,"file":"todoRepository.js","names":["_firebaseAdmin","_interopRequireDefault","require","_db","_pickFields","_prepareDocs","obj","__esModule","default","todoRef","db","collection","getOneTodo","id","fields","docRef","doc","get","data","Error","todo","length","pickFields","getTodosWithParams","params","sort","limit","orderRef","orderBy","parseInt","snapshot","prepareDocs","createTodo","createdTodo","createdAt","admin","firestore","Timestamp","now","updatedAt","add","removeTodos","ids","deletes","map","delete","Promise","all","updateTodos","todos","updates","update","isCompleted"],"sources":["../../src/database/todoRepository.js"],"sourcesContent":["import admin from \"firebase-admin\";\r\nimport db from \"./db\";\r\nimport pickFields from \"../helpers/utils/pickFields\";\r\nimport prepareDocs from \"../helpers/utils/prepareDocs\";\r\n\r\nconst todoRef = db.collection(\"todos\");\r\n\r\nexport async function getOneTodo(id, fields) {\r\n  const docRef = await todoRef.doc(id).get();\r\n  if (!docRef.data()) {\r\n    throw new Error();\r\n  }\r\n  const todo = { ...docRef.data(), id: docRef.id };\r\n\r\n  if (fields?.length > 0) {\r\n    return pickFields(todo, fields);\r\n  }\r\n  return todo;\r\n}\r\n\r\nexport async function getTodosWithParams(params) {\r\n  const { sort = \"desc\", limit } = params;\r\n\r\n  let orderRef = todoRef.orderBy(\"createdAt\", sort);\r\n  if (limit) {\r\n    orderRef = orderRef.limit(parseInt(limit));\r\n  }\r\n  const snapshot = await orderRef.get();\r\n\r\n  return prepareDocs(snapshot);\r\n}\r\n\r\nexport async function createTodo(data) {\r\n  const createdTodo = {\r\n    ...data,\r\n    createdAt: admin.firestore.Timestamp.now(),\r\n    updatedAt: admin.firestore.Timestamp.now(),\r\n  };\r\n  const doc = await todoRef.add(createdTodo);\r\n  return { ...createdTodo, id: doc.id };\r\n}\r\n\r\nexport async function removeTodos(ids) {\r\n  if (!ids?.length) {\r\n    throw new Error();\r\n  }\r\n\r\n  const deletes = ids.map((id) => todoRef.doc(id).delete());\r\n  return await Promise.all(deletes);\r\n}\r\n\r\nexport async function updateTodos(todos) {\r\n  if (!todos?.length) {\r\n    throw new Error();\r\n  }\r\n\r\n  const updates = todos.map((todo) =>\r\n    todoRef.doc(todo.id).update({\r\n      isCompleted: todo.isCompleted,\r\n      updatedAt: admin.firestore.Timestamp.now(),\r\n    })\r\n  );\r\n  return await Promise.all(updates);\r\n}\r\n"],"mappings":"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"}