{"version":3,"file":"todoRepository.js","names":["_firebaseAdmin","_interopRequireDefault","require","_db","_pickFields","_prepareDocs","obj","__esModule","default","todoRef","db","collection","documentId","admin","firestore","FieldPath","getOneTodo","id","fields","docRef","doc","get","data","Error","todo","length","pickFields","getTodosWithParams","params","sort","limit","orderRef","orderBy","parseInt","snapshot","prepareDocs","createTodo","createdTodo","createdAt","Timestamp","now","updatedAt","add","removeTodos","ids","deletes","map","delete","Promise","all","updateTodos","todos","updates","update","isCompleted"],"sources":["../../src/database/todoRepository.js"],"sourcesContent":["import admin from \"firebase-admin\";\r\nimport db from \"./db\";\r\nimport pickFields from \"../helpers/utils/pickFields\";\r\nimport prepareDocs from \"../helpers/utils/prepareDocs\";\r\n\r\nconst todoRef = db.collection(\"todos\");\r\nconst documentId = admin.firestore.FieldPath.documentId();\r\n\r\nexport async function getOneTodo(id, fields) {\r\n  const docRef = await todoRef.doc(id).get();\r\n  if (!docRef.data()) {\r\n    throw new Error();\r\n  }\r\n  const todo = { ...docRef.data(), id: docRef.id };\r\n\r\n  if (fields?.length > 0) {\r\n    return pickFields(todo, fields);\r\n  }\r\n  return todo;\r\n}\r\n\r\nexport async function getTodosWithParams(params) {\r\n  const { sort = \"desc\", limit = 100 } = params;\r\n\r\n  let orderRef = todoRef.orderBy(\"createdAt\", sort);\r\n  if (limit) {\r\n    orderRef = todoRef.orderBy(\"createdAt\", sort).limit(parseInt(limit));\r\n  }\r\n  const snapshot = await orderRef.get();\r\n\r\n  return prepareDocs(snapshot);\r\n}\r\n\r\nexport async function createTodo(data) {\r\n  const createdTodo = {\r\n    ...data,\r\n    createdAt: admin.firestore.Timestamp.now(),\r\n    updatedAt: admin.firestore.Timestamp.now(),\r\n  };\r\n  const doc = await todoRef.add(createdTodo);\r\n  return { ...createdTodo, id: doc.id };\r\n}\r\n\r\nexport async function removeTodos(ids) {\r\n  if (!ids?.length) {\r\n    throw new Error();\r\n  }\r\n\r\n  const deletes = ids.map((id) => todoRef.doc(id).delete());\r\n  return await Promise.all(deletes);\r\n}\r\n\r\nexport async function updateTodos(todos) {\r\n  if (!todos?.length) {\r\n    throw new Error();\r\n  }\r\n\r\n  // const querySnapshot = await todoRef.where(documentId, \"in\", ids).get();\r\n\r\n  // const updates = querySnapshot.docs.map((doc) =>\r\n  //   doc.ref.update({\r\n  //     isCompleted: !doc.data().isCompleted,\r\n  //     updatedAt: admin.firestore.Timestamp.now(),\r\n  //   })\r\n  // );\r\n  const updates = todos.map((todo) =>\r\n    todoRef.doc(todo.id).update({\r\n      isCompleted: todo.isCompleted,\r\n      updatedAt: admin.firestore.Timestamp.now(),\r\n    })\r\n  );\r\n  return await Promise.all(updates);\r\n}\r\n"],"mappings":"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"}