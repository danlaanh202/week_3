{"version":3,"file":"todoRepository.js","names":["_firebaseAdmin","_interopRequireDefault","require","_db","_uuid","obj","__esModule","default","todoRef","db","collection","documentId","admin","firestore","FieldPath","getAllTodos","snapshot","get","docs","map","doc","data","id","createTodo","generatedId","uuid","set","removeTodo","delete","toggleTodo","updateDoc","ref","update","isCompleted","removeMultipleTodos","ids","length","Error","querySnapshot","where","deletes","documentSnapshot","push","Promise","all","completeMultipleTodos","updates"],"sources":["../../src/repositories/todoRepository.js"],"sourcesContent":["import admin from \"firebase-admin\";\r\nimport db from \"../config/db\";\r\nimport { v4 as uuid } from \"uuid\";\r\nconst todoRef = db.collection(\"todos\");\r\nconst documentId = admin.firestore.FieldPath.documentId();\r\nexport async function getAllTodos() {\r\n  const snapshot = await todoRef.get();\r\n  return snapshot.docs.map((doc) => ({ ...doc.data(), id: doc.id }));\r\n}\r\n\r\nexport async function createTodo(data) {\r\n  const generatedId = uuid();\r\n  await todoRef.doc(generatedId).set(data);\r\n  return { ...data, id: generatedId };\r\n}\r\n\r\nexport async function removeTodo(id) {\r\n  return await todoRef.doc(id).delete();\r\n}\r\n\r\nexport async function toggleTodo(id) {\r\n  const updateDoc = await todoRef.doc(id).get();\r\n  await updateDoc.ref.update({\r\n    isCompleted: !updateDoc.data().isCompleted,\r\n  });\r\n}\r\nexport async function removeMultipleTodos(ids) {\r\n  if (!ids?.length) {\r\n    throw new Error(\"\");\r\n  }\r\n\r\n  // ============ Batch writes usage ===========\r\n  /*\r\n  let batch = db.batch();\r\n  const querySnapshot = await todoRef.where(documentId, \"in\", ids).get();\r\n  for (const documentSnapshot of querySnapshot.docs) {\r\n    batch.delete(documentSnapshot.ref);\r\n  }\r\n  return batch.commit();\r\n  */\r\n  // ============ Promise.all usage ===========\r\n  const querySnapshot = await todoRef.where(documentId, \"in\", ids).get();\r\n  const deletes = [];\r\n  for (const documentSnapshot of querySnapshot.docs) {\r\n    deletes.push(documentSnapshot.ref.delete());\r\n  }\r\n  return await Promise.all(deletes);\r\n}\r\nexport async function completeMultipleTodos(ids) {\r\n  if (!ids?.length) {\r\n    throw new Error(\"\");\r\n  }\r\n\r\n  // ============ Batch writes usage ===========\r\n  /* let batch = db.batch();\r\n  const querySnapshot = await todoRef.where(documentId, \"in\", ids).get();\r\n  for (const documentSnapshot of querySnapshot.docs) {\r\n    batch.update(documentSnapshot.ref, {\r\n      isCompleted: true,\r\n    });\r\n  }\r\n  return batch.commit();\r\n  */\r\n\r\n  // ============ Promise.all usage ===========\r\n\r\n  const querySnapshot = await todoRef.where(documentId, \"in\", ids).get();\r\n  const updates = [];\r\n  for (const documentSnapshot of querySnapshot.docs) {\r\n    updates.push(\r\n      documentSnapshot.ref.update({\r\n        isCompleted: !documentSnapshot.data().isCompleted,\r\n      })\r\n    );\r\n  }\r\n  return await Promise.all(updates);\r\n}\r\n"],"mappings":"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"}